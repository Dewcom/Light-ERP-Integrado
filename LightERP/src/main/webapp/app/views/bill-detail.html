<div>
    <div class="row">
        <div class="col-md-7">
            <h3>Detalle de factura</h3>
        </div>
    </div>
    <form class="panel">
        <uib-tabset justified="true">
            <uib-tab>
                <div class="mb">
                    <hr class="hidden-print"/>
                    <div class="clearfix">
                        <button type="button" onclick="window.print();" class="btn btn-labeled btn-info pull-left">
                          <span class="btn-label">
                             <em class="fa fa-print"></em>
                          </span>Imprimir
                        </button>
                        <button type="button" ng-click="controller.cloneBill(currentBill)"
                                class="btn btn-labeled btn-info pull-left ml">
                          <span class="btn-label">
                             <em class="fa fa-copy"></em>
                          </span>Clonar
                        </button>
                        <button type="button" ng-click="controller.goBack()"
                                class="btn btn-labeled btn-info pull-left ml">
                          <span class="btn-label">
                             <em class="fa fa-mail-reply"></em>
                          </span>Regresar
                        </button>
                        <button ng-show="currentBill.billNumber == null" type="button"
                                ng-click="controller.disableBill(currentBill.id)"
                                class="btn btn-labeled btn-danger pull-right">
                          <span class="btn-label">
                             <em class="fa fa-times"></em>
                          </span>Eliminar
                        </button>
                        <button ng-show="currentBill.billNumber == null" type="button"
                                ui-sref="app.updateBill({billId: currentBill.id})"
                                class="btn btn-labeled btn-warning pull-right mr">
                          <span class="btn-label">
                             <em class="fa fa-times"></em>
                          </span>Modificar
                        </button>
                        <button ng-show="currentBill.billState.description == 'Validada'" type="button"
                                ng-click="controller.voidBill(currentBill)"
                                class="btn btn-labeled btn-danger pull-right">
                          <span class="btn-label">
                             <em class="fa fa-times"></em>
                          </span>Anular
                        </button>
                    </div>
                </div>
                <hr>
                <uib-tab-heading>DETALLES</uib-tab-heading>
                <div class="panel">
                    <div class="panel-body">
                        <h3 class="mt0" ng-if="currentBill.billNumber != null">{{"Factura # " +
                            currentBill.billNumber}}</h3>
                        <h3 class="mt0" ng-if="currentBill.billNumber == null">{{"B" + currentBill.id }}</h3>
                        <hr/>
                        <div class="row mb-lg">
                            <div class="col-lg-4 col-xs-6 br pv">
                                <div class="row">
                                    <div class="col-md-2 text-center visible-md visible-lg">
                                        <em class="fa fa-user fa-4x text-muted"></em>
                                    </div>
                                    <div class="col-md-10">
                                        <h4>{{currentBill.customer.name + " " + currentBill.customer.firstLastName + " "
                                            + currentBill.customer.secondLastName}}</h4>
                                        <address></address>
                                        {{currentBill.address.district.name + ", " +
                                        currentBill.address.canton.name}}<br/>
                                        {{currentBill.address.province.name}}<br/>
                                        {{currentBill.address.address}}
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4 col-xs-6 br pv">
                                <div class="row">
                                    <div class="col-md-2 text-center visible-md visible-lg">
                                        <em class="fa fa-phone fa-4x text-muted"></em>
                                    </div>
                                    <div class="col-md-10">
                                        <h4>{{currentBill.customer.contacts[0].name + " " +
                                            currentBill.customer.contacts[0].firstLastName + " " +
                                            currentBill.customer.contacts[0].secondLastName }}</h4>
                                        <address></address>
                                        {{currentBill.customer.contacts[0].phoneNumber1}}<br/>
                                        {{currentBill.customer.contacts[0].mobile}}<br/>
                                        {{currentBill.customer.contacts[0].email}}
                                    </div>
                                </div>
                            </div>
                            <div class="clearfix hidden-md hidden-lg">
                                <hr/>
                            </div>
                            <div class="col-lg-4 col-xs-12 pv">
                                <div class="clearfix">
                                    <p class="pull-left">FACTURA NO.</p>
                                    <p class="pull-right mr" ng-if="currentBill.billNumber != null">
                                        {{currentBill.billNumber}}</p>
                                    <p class="pull-right mr" ng-if="currentBill.billNumber == null">{{"B" +
                                        currentBill.id }}</p>
                                </div>
                                <div class="clearfix">
                                    <p class="pull-left">Fecha de facturación</p>
                                    <p class="pull-right mr">{{currentBill.billDate | date:'MM/dd/yyyy'}}</p>
                                </div>
                                <div class="clearfix">
                                    <p class="pull-left">Fecha de vencimiento</p>
                                    <p class="pull-right mr">{{currentBill.dueDate | date:'MM/dd/yyyy'}}</p>
                                </div>
                            </div>
                        </div>
                        <div class="table-responsive table-bordered mb-lg">
                            <table class="table">
                                <thead>
                                <tr>
                                    <th>Código</th>
                                    <th>Producto</th>
                                    <th>Cantidad</th>
                                    <th>Impuestos</th>
                                    <th>Descuentos</th>
                                    <th>Subtotal</th>
                                    <th class="text-right">Total</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr ng-repeat="billDetail in currentBill.billDetails">
                                    <td>{{billDetail.product.productCode}}</td>
                                    <td>{{billDetail.product.name}}</td>
                                    <td>{{billDetail.quantity}}</td>
                                    <td ng-if="billDetail.currency.currencyCode == 3">{{ billDetail.totalTaxAmount |
                                        currency : "$" : 2}}
                                    </td>
                                    <td ng-if="billDetail.currency.currencyCode != 3">{{ billDetail.totalTaxAmount |
                                        currency : "₡" : 2}}
                                    </td>
                                    <td ng-if="billDetail.currency.currencyCode == 3">{{ billDetail.totalDiscount |
                                        currency : "$" : 2}}
                                    </td>
                                    <td ng-if="billDetail.currency.currencyCode != 3">{{ billDetail.totalDiscount |
                                        currency : "₡" : 2}}
                                    </td>
                                    <td ng-if="billDetail.currency.currencyCode == 3">{{ billDetail.subTotal | currency
                                        : "$" : 2}}
                                    </td>
                                    <td ng-if="billDetail.currency.currencyCode != 3">{{ billDetail.subTotal | currency
                                        : "₡" : 2}}
                                    </td>
                                    <td class="text-right" ng-if="billDetail.currency.currencyCode == 3">{{
                                        billDetail.total | currency : "$" : 2}}
                                    </td>
                                    <td class="text-right" ng-if="billDetail.currency.currencyCode != 3">{{
                                        billDetail.total | currency : "₡" : 2}}
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="row">
                            <div class="col-sm-offset-8 col-sm-4 pv">
                                <div class="clearfix">
                                    <p class="pull-left">Subtotal</p>
                                    <p class="pull-right mr" ng-if="currentBill.currency.currencyCode == 3">{{
                                        currentBill.subTotalAmount | currency : "$" : 2}}</p>
                                    <p class="pull-right mr" ng-if="currentBill.currency.currencyCode != 3">{{
                                        currentBill.subTotalAmount | currency : "₡" : 2}}</p>
                                </div>
                                <div class="clearfix">
                                    <p class="pull-left">Total de descuentos</p>
                                    <p class="pull-right mr" ng-if="currentBill.currency.currencyCode == 3">{{
                                        currentBill.totalDiscount | currency : "$" : 2}}</p>
                                    <p class="pull-right mr" ng-if="currentBill.currency.currencyCode != 3">{{
                                        currentBill.totalDiscount | currency : "₡" : 2}}</p>
                                </div>
                                <div class="clearfix">
                                    <p class="pull-left">Total de impuestos</p>
                                    <p class="pull-right mr" ng-if="currentBill.currency.currencyCode == 3">{{
                                        currentBill.totalTaxAmount | currency : "$" : 2}}</p>
                                    <p class="pull-right mr" ng-if="currentBill.currency.currencyCode != 3">{{
                                        currentBill.totalTaxAmount | currency : "₡" : 2}}</p>
                                </div>
                                <div class="clearfix">
                                    <p class="pull-left h3">TOTAL</p>
                                    <p class="pull-right h3 mr" ng-if="currentBill.currency.currencyCode == 3">{{
                                        currentBill.totalAmount | currency : "$" : 2}}</p>
                                    <p class="pull-right h3 mr" ng-if="currentBill.currency.currencyCode != 3">{{
                                        currentBill.totalAmount | currency : "₡" : 2}}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </uib-tab>
            <uib-tab>
                <uib-tab-heading>PAGOS</uib-tab-heading>
            </uib-tab>
        </uib-tabset>
    </form>
    <div class="panel panel-default" ng-show="currentBill.billState.code != 1">
        <div class="panel-body">
            <div>
                <div class="col-md-12 dataTableTop">
                    <div class="col-md-9">
                        <h3>Lista de pagos</h3>
                    </div>
                    <div ng-click="controller.open('lg')" class="pull-right" ng-show="currentBill.billState.code != 4">
                        <button ng-show="currentBill.billState.code == '2' || currentBill.billState.code == '3'" type="button"
                                ng-click="controller.openPaymentModal(currentBill)"
                                class="btn btn-labeled btn-success">
                          <span class="btn-label">
                             <em class="fa fa-money"></em>
                          </span>Emitir pago
                        </button>
                    </div>
                </div>
                <table datatable="ng" dt-options="controller.dtOptions" dt-column-defs="controller.dtColumnDefs"
                       class="row-border hover">
                    <thead>
                    <tr>
                        <th>Monto</th>
                        <th>Banco</th>
                        <th>Recibo bancario</th>
                        <th>Observaciones</th>
                        <th ng-show="currentBill.billState.code != 4">Opciones</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr ng-repeat="paymentObj in currentBill.payments">
                        <td>{{ paymentObj.amount }}</td>
                        <td ng-if="paymentObj.bank == null">**SIN BANCO**</td>
                        <td ng-if="paymentObj.bank != null">{{ paymentObj.bank }}</td>
                        <td ng-if="paymentObj.bankReceipt == null">**SIN COMPROBANTE**</td>
                        <td ng-if="paymentObj.bankReceipt != null">{{ paymentObj.bankReceipt }}</td>
                        <td ng-if="paymentObj.observation == null">**SIN OBSERVACIONES**</td>
                        <td ng-if="paymentObj.observation != null">{{ paymentObj.observation }}</td>
                        <td ng-show="currentBill.billState.code != 4">
                            <button type="button" ng-click="controller.openUpdatePaymentModal(paymentObj)" class="btn btn-sm btn-toolbar">
                                <em class="fa fa-search"></em>
                            </button>
                            <button type="button" ng-click="controller.deletePayment(paymentObj.id)"
                                    class="btn btn-sm btn-danger">
                                <em class="fa fa-trash-o"></em>
                            </button >
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <toaster-container
            toaster-options="{'position-class': 'toast-bottom-right', 'close-button':true}"></toaster-container>
    <script type="text/ng-template" id="voidBillModal">
        <div class="ngdialog-message text-center">
            <h3>Anular factura</h3>
            <p>¿Está seguro que desea anular la factura?</p>
            <div>
                <button type="button" ng-click="confirm(confirmValue)" class="btn btn-primary mr">Confirmar</button>
                <button type="button" ng-click="closeThisDialog('button')" class="btn btn-default">Cancelar</button>
            </div>
        </div>
    </script>
    <script type="text/ng-template" id="deletePaymentModal">
    <div class="ngdialog-message text-center">
        <h3>Eliminar pago</h3>
        <p>¿Está seguro que desea eliminar el pago?</p>
        <div>
            <button type="button" ng-click="confirm(confirmValue)" class="btn btn-primary mr">Confirmar</button>
            <button type="button" ng-click="closeThisDialog('button')" class="btn btn-default">Cancelar</button>
        </div>
    </div>
    </script>
    <div ng-include="'app/views/modals/make-payment-modal.html'"></div>
    <div ng-include="'app/views/modals/update-payment-modal.html'"></div>
</div>
